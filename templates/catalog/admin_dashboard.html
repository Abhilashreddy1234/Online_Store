{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard - Fashion Store{% endblock %}

{% block extra_css %}
<style>
    /* Dashboard Layout */
    .dashboard-wrapper {
        display: flex;
        min-height: calc(100vh - 80px);
        margin: calc(-1 * var(--space-8)) calc(-1 * var(--space-4));
        margin-top: calc(-1 * var(--space-8));
    }
    
    /* Sidebar */
    .dashboard-sidebar {
        width: 260px;
        background: linear-gradient(180deg, var(--gray-900) 0%, var(--gray-800) 100%);
        color: white;
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
        flex-shrink: 0;
        transition: all var(--transition-base);
        z-index: 50;
    }
    
    .sidebar-header {
        padding: var(--space-6);
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .sidebar-logo {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        font-size: var(--text-lg);
        font-weight: 700;
    }
    
    .sidebar-logo-icon {
        font-size: var(--text-2xl);
    }
    
    .sidebar-nav {
        padding: var(--space-4) 0;
    }
    
    .sidebar-section {
        margin-bottom: var(--space-4);
    }
    
    .sidebar-section-title {
        padding: var(--space-2) var(--space-6);
        font-size: var(--text-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--gray-500);
    }
    
    .sidebar-link {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-3) var(--space-6);
        color: var(--gray-300);
        font-size: var(--text-sm);
        font-weight: 500;
        transition: all var(--transition-fast);
        cursor: pointer;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
    }
    
    .sidebar-link:hover {
        background: rgba(255,255,255,0.05);
        color: white;
    }
    
    .sidebar-link.active {
        background: rgba(99, 102, 241, 0.2);
        color: var(--primary-300);
        border-left: 3px solid var(--primary-400);
    }
    
    .sidebar-link-icon {
        font-size: var(--text-lg);
        width: 24px;
        text-align: center;
    }
    
    .sidebar-badge {
        margin-left: auto;
        background: var(--error-500);
        color: white;
        font-size: var(--text-xs);
        padding: 2px 8px;
        border-radius: var(--radius-full);
        font-weight: 600;
    }
    
    /* Main Content */
    .dashboard-main {
        flex: 1;
        padding: var(--space-6);
        background: var(--gray-50);
        overflow-x: hidden;
    }
    
    .dashboard-header {
        margin-bottom: var(--space-6);
    }
    
    .dashboard-title {
        font-size: var(--text-2xl);
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: var(--space-1);
    }
    
    .dashboard-subtitle {
        color: var(--gray-500);
    }
    
    /* Section Content */
    .dashboard-section {
        display: none;
        animation: fadeIn 0.3s ease;
    }
    
    .dashboard-section.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Metrics Grid */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--space-4);
        margin-bottom: var(--space-6);
    }
    
    .metric-card {
        background: white;
        border-radius: var(--radius-xl);
        padding: var(--space-5);
        box-shadow: var(--shadow-sm);
        transition: all var(--transition-fast);
        position: relative;
        overflow: hidden;
    }
    
    .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
    }
    
    .metric-card.orders::before { background: var(--primary-500); }
    .metric-card.revenue::before { background: var(--success-500); }
    .metric-card.profit::before { background: var(--warning-500); }
    .metric-card.sales::before { background: var(--info-500); }
    
    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }
    
    .metric-icon {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-xl);
        margin-bottom: var(--space-3);
    }
    
    .metric-card.orders .metric-icon { background: var(--primary-100); }
    .metric-card.revenue .metric-icon { background: var(--success-100); }
    .metric-card.profit .metric-icon { background: var(--warning-100); }
    .metric-card.sales .metric-icon { background: var(--info-100); }
    
    .metric-label {
        font-size: var(--text-sm);
        color: var(--gray-500);
        margin-bottom: var(--space-1);
    }
    
    .metric-value {
        font-size: var(--text-2xl);
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: var(--space-1);
    }
    
    .metric-change {
        font-size: var(--text-sm);
        color: var(--success-600);
        display: flex;
        align-items: center;
        gap: var(--space-1);
    }
    
    .metric-change.negative {
        color: var(--error-500);
    }
    
    /* Charts Grid */
    .charts-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: var(--space-4);
        margin-bottom: var(--space-6);
    }
    
    .chart-card {
        background: white;
        border-radius: var(--radius-xl);
        padding: var(--space-5);
        box-shadow: var(--shadow-sm);
    }
    
    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-4);
    }
    
    .chart-title {
        font-size: var(--text-lg);
        font-weight: 600;
        color: var(--gray-800);
    }
    
    .chart-container {
        position: relative;
        height: 280px;
    }
    
    /* Widgets Grid */
    .widgets-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-4);
        margin-bottom: var(--space-6);
    }
    
    .widget-card {
        background: white;
        border-radius: var(--radius-xl);
        padding: var(--space-5);
        box-shadow: var(--shadow-sm);
    }
    
    .widget-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-4);
    }
    
    .widget-title {
        font-size: var(--text-base);
        font-weight: 600;
        color: var(--gray-800);
        display: flex;
        align-items: center;
        gap: var(--space-2);
    }
    
    .widget-badge {
        background: var(--error-500);
        color: white;
        font-size: var(--text-xs);
        padding: 2px 8px;
        border-radius: var(--radius-full);
        font-weight: 600;
    }
    
    .widget-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
    }
    
    .widget-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-3);
        background: var(--gray-50);
        border-radius: var(--radius-lg);
        transition: background var(--transition-fast);
    }
    
    .widget-item:hover {
        background: var(--gray-100);
    }
    
    .widget-item-info h4 {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 2px;
    }
    
    .widget-item-info p {
        font-size: var(--text-xs);
        color: var(--gray-500);
    }
    
    .widget-item-value {
        text-align: right;
    }
    
    .widget-item-value .amount {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--gray-800);
    }
    
    .widget-item-value .label {
        font-size: var(--text-xs);
        color: var(--gray-500);
    }
    
    .status-badge {
        padding: 4px 12px;
        border-radius: var(--radius-full);
        font-size: var(--text-xs);
        font-weight: 600;
    }
    
    .status-pending { background: var(--warning-100); color: var(--warning-600); }
    .status-processing { background: var(--info-100); color: var(--info-600); }
    .status-shipped { background: var(--primary-100); color: var(--primary-600); }
    .status-delivered { background: var(--success-100); color: var(--success-600); }
    .status-cancelled { background: var(--error-100); color: var(--error-600); }
    
    .stock-alert {
        color: var(--error-500);
        font-weight: 600;
    }
    
    /* Data Table */
    .data-table-card {
        background: white;
        border-radius: var(--radius-xl);
        padding: var(--space-5);
        box-shadow: var(--shadow-sm);
        margin-bottom: var(--space-6);
    }
    
    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-4);
    }
    
    .table-search {
        display: flex;
        gap: var(--space-3);
    }
    
    .table-search input {
        padding: var(--space-2) var(--space-4);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        font-size: var(--text-sm);
        min-width: 250px;
    }
    
    .table-search input:focus {
        outline: none;
        border-color: var(--primary-500);
    }
    
    .data-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .data-table th {
        background: var(--gray-50);
        padding: var(--space-3) var(--space-4);
        text-align: left;
        font-size: var(--text-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--gray-600);
        border-bottom: 2px solid var(--gray-200);
    }
    
    .data-table td {
        padding: var(--space-4);
        border-bottom: 1px solid var(--gray-100);
        font-size: var(--text-sm);
        color: var(--gray-700);
    }
    
    .data-table tr:hover td {
        background: var(--gray-50);
    }
    
    /* Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-4);
    }
    
    .stat-item {
        display: flex;
        justify-content: space-between;
        padding: var(--space-4);
        background: var(--gray-50);
        border-radius: var(--radius-lg);
    }
    
    .stat-item .stat-label {
        color: var(--gray-600);
        font-size: var(--text-sm);
    }
    
    .stat-item .stat-value {
        font-size: var(--text-lg);
        font-weight: 700;
        color: var(--gray-900);
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: var(--space-10);
        color: var(--gray-500);
    }
    
    .empty-state-icon {
        font-size: 3rem;
        margin-bottom: var(--space-3);
    }
    
    /* Responsive Sidebar */
    .sidebar-toggle {
        display: none;
        position: fixed;
        bottom: var(--space-4);
        right: var(--space-4);
        width: 56px;
        height: 56px;
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: var(--radius-full);
        font-size: var(--text-xl);
        cursor: pointer;
        z-index: 100;
        box-shadow: var(--shadow-lg);
    }
    
    .sidebar-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 40;
    }
    
    @media (max-width: 1200px) {
        .metrics-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .charts-grid {
            grid-template-columns: 1fr;
        }
        
        .widgets-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 992px) {
        .dashboard-sidebar {
            position: fixed;
            left: -280px;
            top: 0;
            height: 100vh;
            z-index: 60;
        }
        
        .dashboard-sidebar.open {
            left: 0;
        }
        
        .sidebar-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sidebar-overlay.open {
            display: block;
        }
        
        .dashboard-main {
            padding: var(--space-4);
        }
    }
    
    @media (max-width: 768px) {
        .metrics-grid,
        .widgets-grid {
            grid-template-columns: 1fr;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .table-header {
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .table-search {
            width: 100%;
        }
        
        .table-search input {
            flex: 1;
            min-width: auto;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    
    <!-- Sidebar -->
    <aside class="dashboard-sidebar" id="dashboard-sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <span class="sidebar-logo-icon">üìä</span>
                <span>Dashboard</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <div class="sidebar-section">
                <div class="sidebar-section-title">Main</div>
                <button class="sidebar-link active" data-section="overview">
                    <span class="sidebar-link-icon">üè†</span>
                    <span>Overview</span>
                </button>
                <button class="sidebar-link" data-section="analytics">
                    <span class="sidebar-link-icon">üìà</span>
                    <span>Analytics</span>
                </button>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">Store</div>
                <button class="sidebar-link" data-section="products">
                    <span class="sidebar-link-icon">üì¶</span>
                    <span>Products</span>
                    {% if out_of_stock_count > 0 %}
                    <span class="sidebar-badge">{{ out_of_stock_count }}</span>
                    {% endif %}
                </button>
                <button class="sidebar-link" data-section="orders">
                    <span class="sidebar-link-icon">üõí</span>
                    <span>Orders</span>
                    <span class="sidebar-badge">{{ recent_orders_count }}</span>
                </button>
                <button class="sidebar-link" data-section="customers">
                    <span class="sidebar-link-icon">üë•</span>
                    <span>Customers</span>
                </button>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">Management</div>
                <button class="sidebar-link" data-section="reviews">
                    <span class="sidebar-link-icon">‚≠ê</span>
                    <span>Reviews</span>
                    {% if pending_reviews_count > 0 %}
                    <span class="sidebar-badge">{{ pending_reviews_count }}</span>
                    {% endif %}
                </button>
                <a href="/admin/" class="sidebar-link">
                    <span class="sidebar-link-icon">‚öôÔ∏è</span>
                    <span>Admin Panel</span>
                </a>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">Quick Links</div>
                <a href="{% url 'catalog:home' %}" class="sidebar-link">
                    <span class="sidebar-link-icon">üè™</span>
                    <span>View Store</span>
                </a>
            </div>
        </nav>
    </aside>
    
    <!-- Main Content -->
    <main class="dashboard-main">
        <!-- Overview Section -->
        <section class="dashboard-section active" id="section-overview">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Dashboard Overview</h1>
                <p class="dashboard-subtitle">Welcome back! Here's what's happening with your store today.</p>
            </div>
            
            <!-- Key Metrics -->
            <div class="metrics-grid">
                <div class="metric-card orders">
                    <div class="metric-icon">üìã</div>
                    <div class="metric-label">Total Orders</div>
                    <div class="metric-value">{{ total_orders|default:0 }}</div>
                    <div class="metric-change">
                        <span>‚Üë +{{ recent_orders_count|default:0 }} this month</span>
                    </div>
                </div>
                
                <div class="metric-card revenue">
                    <div class="metric-icon">üí∞</div>
                    <div class="metric-label">Total Revenue</div>
                    <div class="metric-value">‚Çπ{{ total_revenue|floatformat:0|default:"0" }}</div>
                    <div class="metric-change">
                        <span>‚Üë ‚Çπ{{ recent_revenue|floatformat:0|default:"0" }} this month</span>
                    </div>
                </div>
                
                <div class="metric-card profit">
                    <div class="metric-icon">üìä</div>
                    <div class="metric-label">Total Profit</div>
                    <div class="metric-value">‚Çπ{{ total_profit|floatformat:0|default:"0" }}</div>
                    <div class="metric-change">
                        <span>Gross margin</span>
                    </div>
                </div>
                
                <div class="metric-card sales">
                    <div class="metric-icon">üõçÔ∏è</div>
                    <div class="metric-label">Items Sold</div>
                    <div class="metric-value">{{ total_sales|default:0 }}</div>
                    <div class="metric-change">
                        <span>Avg: ‚Çπ{{ avg_order_value|floatformat:0|default:"0" }}/order</span>
                    </div>
                </div>
            </div>
            
            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">üìà Monthly Revenue</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">üéØ Sales by Category</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Widgets -->
            <div class="widgets-grid">
                <!-- Recent Orders -->
                <div class="widget-card">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            üì¶ Recent Orders
                            <span class="widget-badge">{{ recent_orders_list|length }}</span>
                        </h3>
                    </div>
                    <div class="widget-list">
                        {% for order in recent_orders_list|slice:":5" %}
                        <div class="widget-item">
                            <div class="widget-item-info">
                                <h4>#{{ order.order_number }}</h4>
                                <p>{{ order.customer.get_full_name|default:order.customer.username }}</p>
                            </div>
                            <div class="widget-item-value">
                                <span class="status-badge status-{{ order.status|lower }}">{{ order.get_status_display }}</span>
                                <div class="amount">‚Çπ{{ order.total_amount|floatformat:0 }}</div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <div class="empty-state-icon">üì≠</div>
                            <p>No recent orders</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Low Stock Alerts -->
                <div class="widget-card">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            ‚ö†Ô∏è Low Stock Alerts
                            <span class="widget-badge">{{ low_stock_products|length }}</span>
                        </h3>
                    </div>
                    <div class="widget-list">
                        {% for product in low_stock_products|slice:":5" %}
                        <div class="widget-item">
                            <div class="widget-item-info">
                                <h4>{{ product.name|truncatechars:25 }}</h4>
                                <p>{{ product.category.name }}</p>
                            </div>
                            <div class="widget-item-value">
                                <span class="stock-alert">{{ product.stock_quantity }} left</span>
                                <div class="label">Min: {{ product.low_stock_threshold }}</div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <div class="empty-state-icon">‚úÖ</div>
                            <p>All products well stocked</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Customer Statistics -->
                <div class="widget-card">
                    <div class="widget-header">
                        <h3 class="widget-title">üë• Customer Stats</h3>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Total Customers</span>
                            <span class="stat-value">{{ total_customers }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">New This Month</span>
                            <span class="stat-value" style="color: var(--success-600);">+{{ new_customers_30d }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Pending Reviews</span>
                            <span class="stat-value" style="color: var(--warning-600);">{{ pending_reviews_count }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Out of Stock</span>
                            <span class="stat-value" style="color: var(--error-500);">{{ out_of_stock_count }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Analytics Section -->
        <section class="dashboard-section" id="section-analytics">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Analytics</h1>
                <p class="dashboard-subtitle">Detailed insights into your store's performance</p>
            </div>
            
            <div class="charts-grid" style="grid-template-columns: 1fr 1fr;">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">üèÜ Top Selling Products</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="topProductsChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">üìä Order Status Distribution</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="orderStatusChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Top Products Table -->
            <div class="data-table-card">
                <div class="table-header">
                    <h3 class="chart-title">üî• Top Selling Products</h3>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th style="text-align: center;">Units Sold</th>
                            <th style="text-align: right;">Revenue</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in top_products %}
                        <tr>
                            <td><strong>{{ product.product__name }}</strong></td>
                            <td style="text-align: center;">{{ product.total_sold }}</td>
                            <td style="text-align: right; font-weight: 600; color: var(--success-600);">‚Çπ{{ product.revenue|floatformat:0 }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3" class="empty-state">No sales data available</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Products Section -->
        <section class="dashboard-section" id="section-products">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Products</h1>
                <p class="dashboard-subtitle">Manage your product inventory</p>
            </div>
            
            <div class="metrics-grid" style="grid-template-columns: repeat(3, 1fr);">
                <div class="metric-card orders">
                    <div class="metric-icon">üì¶</div>
                    <div class="metric-label">Total Products</div>
                    <div class="metric-value">{{ total_sales|default:0 }}</div>
                </div>
                <div class="metric-card profit">
                    <div class="metric-icon">‚ö†Ô∏è</div>
                    <div class="metric-label">Low Stock</div>
                    <div class="metric-value">{{ low_stock_products|length }}</div>
                </div>
                <div class="metric-card sales">
                    <div class="metric-icon">‚ùå</div>
                    <div class="metric-label">Out of Stock</div>
                    <div class="metric-value">{{ out_of_stock_count }}</div>
                </div>
            </div>
            
            <div class="data-table-card">
                <div class="table-header">
                    <h3 class="chart-title">Low Stock Products</h3>
                    <a href="/admin/catalog/product/" class="btn btn-primary" style="font-size: var(--text-sm);">Manage Products</a>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Category</th>
                            <th style="text-align: center;">Stock</th>
                            <th style="text-align: center;">Threshold</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in low_stock_products %}
                        <tr>
                            <td><strong>{{ product.name|truncatechars:30 }}</strong></td>
                            <td>{{ product.category.name }}</td>
                            <td style="text-align: center;" class="stock-alert">{{ product.stock_quantity }}</td>
                            <td style="text-align: center;">{{ product.low_stock_threshold }}</td>
                            <td><span class="status-badge status-pending">Low Stock</span></td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="empty-state">All products are well stocked</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Orders Section -->
        <section class="dashboard-section" id="section-orders">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Orders</h1>
                <p class="dashboard-subtitle">Recent orders and sales data</p>
            </div>
            
            <div class="data-table-card">
                <div class="table-header">
                    <h3 class="chart-title">Recent Orders</h3>
                    <a href="/admin/orders/order/" class="btn btn-primary" style="font-size: var(--text-sm);">View All Orders</a>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Status</th>
                            <th style="text-align: right;">Amount</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in recent_orders_list %}
                        <tr>
                            <td><strong>#{{ order.order_number }}</strong></td>
                            <td>{{ order.customer.get_full_name|default:order.customer.username }}</td>
                            <td><span class="status-badge status-{{ order.status|lower }}">{{ order.get_status_display }}</span></td>
                            <td style="text-align: right; font-weight: 600;">‚Çπ{{ order.total_amount|floatformat:0 }}</td>
                            <td>{{ order.created_at|date:"M d, Y" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="empty-state">No orders yet</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Customers Section -->
        <section class="dashboard-section" id="section-customers">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Customers</h1>
                <p class="dashboard-subtitle">Customer statistics and management</p>
            </div>
            
            <div class="metrics-grid" style="grid-template-columns: repeat(3, 1fr);">
                <div class="metric-card orders">
                    <div class="metric-icon">üë•</div>
                    <div class="metric-label">Total Customers</div>
                    <div class="metric-value">{{ total_customers }}</div>
                </div>
                <div class="metric-card revenue">
                    <div class="metric-icon">üÜï</div>
                    <div class="metric-label">New This Month</div>
                    <div class="metric-value">{{ new_customers_30d }}</div>
                </div>
                <div class="metric-card sales">
                    <div class="metric-icon">üíµ</div>
                    <div class="metric-label">Avg Order Value</div>
                    <div class="metric-value">‚Çπ{{ avg_order_value|floatformat:0 }}</div>
                </div>
            </div>
            
            <div class="data-table-card">
                <div class="table-header">
                    <h3 class="chart-title">Customer Management</h3>
                    <a href="/admin/customers/customer/" class="btn btn-primary" style="font-size: var(--text-sm);">Manage Customers</a>
                </div>
                <div class="empty-state">
                    <div class="empty-state-icon">üë•</div>
                    <p>Use the admin panel to view and manage customer details</p>
                </div>
            </div>
        </section>
        
        <!-- Reviews Section -->
        <section class="dashboard-section" id="section-reviews">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Reviews</h1>
                <p class="dashboard-subtitle">Pending reviews awaiting approval</p>
            </div>
            
            <div class="metrics-grid" style="grid-template-columns: repeat(2, 1fr);">
                <div class="metric-card profit">
                    <div class="metric-icon">‚è≥</div>
                    <div class="metric-label">Pending Reviews</div>
                    <div class="metric-value">{{ pending_reviews_count }}</div>
                </div>
                <div class="metric-card revenue">
                    <div class="metric-icon">‚úÖ</div>
                    <div class="metric-label">Review Status</div>
                    <div class="metric-value">Awaiting</div>
                </div>
            </div>
            
            <div class="data-table-card">
                <div class="table-header">
                    <h3 class="chart-title">Review Management</h3>
                    <a href="/admin/catalog/review/" class="btn btn-primary" style="font-size: var(--text-sm);">Manage Reviews</a>
                </div>
                <div class="empty-state">
                    <div class="empty-state-icon">‚≠ê</div>
                    <p>{{ pending_reviews_count }} review(s) pending approval in admin panel</p>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Mobile Toggle Button -->
    <button class="sidebar-toggle" id="sidebar-toggle">‚ò∞</button>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
(function() {
    // Sidebar Navigation
    const sidebarLinks = document.querySelectorAll('.sidebar-link[data-section]');
    const sections = document.querySelectorAll('.dashboard-section');
    const sidebar = document.getElementById('dashboard-sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    
    sidebarLinks.forEach(link => {
        link.addEventListener('click', function() {
            const sectionId = this.getAttribute('data-section');
            
            // Update active link
            sidebarLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
            
            // Show corresponding section
            sections.forEach(section => {
                section.classList.remove('active');
                if (section.id === 'section-' + sectionId) {
                    section.classList.add('active');
                }
            });
            
            // Close mobile sidebar
            if (window.innerWidth <= 992) {
                closeSidebar();
            }
        });
    });
    
    // Mobile Sidebar Toggle
    function openSidebar() {
        sidebar.classList.add('open');
        sidebarOverlay.classList.add('open');
        document.body.style.overflow = 'hidden';
    }
    
    function closeSidebar() {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('open');
        document.body.style.overflow = '';
    }
    
    sidebarToggle.addEventListener('click', () => {
        if (sidebar.classList.contains('open')) {
            closeSidebar();
        } else {
            openSidebar();
        }
    });
    
    sidebarOverlay.addEventListener('click', closeSidebar);
    
    // Charts
    const revenueData = {{ monthly_revenue|safe }};
    
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart');
    if (revenueCtx) {
        new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: revenueData.map(d => d.month),
                datasets: [{
                    label: 'Revenue',
                    data: revenueData.map(d => d.revenue),
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointBackgroundColor: '#6366f1',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        callbacks: {
                            label: (context) => `Revenue: ‚Çπ${context.parsed.y.toLocaleString()}`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: '#f3f4f6' },
                        ticks: { callback: (value) => '‚Çπ' + value.toLocaleString() }
                    },
                    x: { grid: { display: false } }
                }
            }
        });
    }
    
    // Category Chart
    const categoryCtx = document.getElementById('categoryChart');
    if (categoryCtx) {
        const categoryData = [
            {% for cat in category_sales %}
            { name: '{{ cat.product__category__name|default:"Other" }}', value: {{ cat.total_sales }} },
            {% endfor %}
        ];
        
        new Chart(categoryCtx, {
            type: 'doughnut',
            data: {
                labels: categoryData.map(d => d.name),
                datasets: [{
                    data: categoryData.map(d => d.value),
                    backgroundColor: ['#6366f1', '#10b981', '#f59e0b', '#3b82f6', '#ef4444', '#8b5cf6'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { padding: 15 } }
                }
            }
        });
    }
    
    // Top Products Chart
    const productsCtx = document.getElementById('topProductsChart');
    if (productsCtx) {
        const productsData = [
            {% for product in top_products|slice:":5" %}
            { name: '{{ product.product__name|truncatechars:15 }}', sold: {{ product.total_sold }} },
            {% endfor %}
        ];
        
        new Chart(productsCtx, {
            type: 'bar',
            data: {
                labels: productsData.map(d => d.name),
                datasets: [{
                    label: 'Units Sold',
                    data: productsData.map(d => d.sold),
                    backgroundColor: '#10b981',
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { color: '#f3f4f6' } },
                    x: { grid: { display: false } }
                }
            }
        });
    }
    
    // Order Status Chart
    const orderStatusCtx = document.getElementById('orderStatusChart');
    if (orderStatusCtx) {
        const statusData = [
            {% for status in order_status_dist %}
            { name: '{{ status.status }}', count: {{ status.count }} },
            {% endfor %}
        ];
        
        new Chart(orderStatusCtx, {
            type: 'pie',
            data: {
                labels: statusData.map(d => d.name),
                datasets: [{
                    data: statusData.map(d => d.count),
                    backgroundColor: ['#f59e0b', '#3b82f6', '#6366f1', '#10b981', '#ef4444'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { padding: 15 } }
                }
            }
        });
    }
})();
</script>
{% endblock %}
