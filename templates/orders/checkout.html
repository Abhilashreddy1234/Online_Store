{% extends 'base.html' %}

{% block title %}Checkout - Fashion Store{% endblock %}

{% block content %}
<div class="container">
    <h1 style="font-size: 2.5rem; margin-bottom: 2rem;">Checkout</h1>
    
    <form method="post" action="{% url 'orders:place_order' %}">
        {% csrf_token %}
        
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
            <div>
                <!-- Shipping Address -->
                <div class="card">
                    <h3 style="margin-bottom: 1.5rem;">Shipping Address</h3>
                    
                    {% if shipping_addresses %}
                    {% for address in shipping_addresses %}
                    <div style="border: 2px solid #e2e8f0; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="radio" name="shipping_address" value="{{ address.id }}" {% if address.is_default %}checked{% endif %} required style="margin-right: 1rem; margin-top: 0.3rem;">
                            <div>
                                <strong>{{ address.full_name }}</strong><br>
                                {{ address.address_line1 }}{% if address.address_line2 %}, {{ address.address_line2 }}{% endif %}<br>
                                {{ address.city }}, {{ address.state }} {{ address.postal_code }}<br>
                                {{ address.country }}<br>
                                <small style="color: #718096;">ðŸ“ž {{ address.phone }}</small>
                                {% if address.is_default %}
                                <span class="badge badge-info" style="margin-left: 1rem;">Default</span>
                                {% endif %}
                            </div>
                        </label>
                    </div>
                    {% endfor %}
                    <a href="{% url 'customers:add_address' %}" class="btn btn-secondary" style="padding: 0.6rem 1.5rem;">+ Add New Address</a>
                    {% else %}
                    <p style="color: #718096; margin-bottom: 1rem;">No shipping address found.</p>
                    <a href="{% url 'customers:add_address' %}" class="btn">Add Shipping Address</a>
                    {% endif %}
                </div>
                
                <!-- Billing Address -->
                <div class="card">
                    <h3 style="margin-bottom: 1.5rem;">Billing Address</h3>
                    
                    {% if billing_addresses %}
                    {% for address in billing_addresses %}
                    <div style="border: 2px solid #e2e8f0; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="radio" name="billing_address" value="{{ address.id }}" {% if address.is_default %}checked{% endif %} required style="margin-right: 1rem; margin-top: 0.3rem;">
                            <div>
                                <strong>{{ address.full_name }}</strong><br>
                                {{ address.address_line1 }}{% if address.address_line2 %}, {{ address.address_line2 }}{% endif %}<br>
                                {{ address.city }}, {{ address.state }} {{ address.postal_code }}<br>
                                {{ address.country }}<br>
                                <small style="color: #718096;">ðŸ“ž {{ address.phone }}</small>
                                {% if address.is_default %}
                                <span class="badge badge-info" style="margin-left: 1rem;">Default</span>
                                {% endif %}
                            </div>
                        </label>
                    </div>
                    {% endfor %}
                    <a href="{% url 'customers:add_address' %}" class="btn btn-secondary" style="padding: 0.6rem 1.5rem;">+ Add New Address</a>
                    {% else %}
                    <p style="color: #718096; margin-bottom: 1rem;">No billing address found.</p>
                    <a href="{% url 'customers:add_address' %}" class="btn">Add Billing Address</a>
                    {% endif %}
                </div>
                
                <!-- Payment Method -->
                <div class="card">
                    <h3 style="margin-bottom: 1.5rem;">Payment Method</h3>
                    
                    <div style="border: 2px solid #e2e8f0; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="payment_method" value="COD" checked required style="margin-right: 1rem;">
                            <div>
                                <strong>ðŸ’µ Cash on Delivery</strong><br>
                                <small style="color: #718096;">Pay when you receive your order</small>
                            </div>
                        </label>
                    </div>
                    
                    <div style="border: 2px solid #e2e8f0; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="payment_method" value="CARD" style="margin-right: 1rem;">
                            <div>
                                <strong>ðŸ’³ Credit/Debit Card</strong><br>
                                <small style="color: #718096;">Coming soon</small>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Coupon Code -->
                <div class="card">
                    <h3 style="margin-bottom: 1.5rem;">Discount Coupon</h3>
                    <div class="form-group">
                        <input type="text" name="coupon_code" placeholder="Enter coupon code" class="form-control">
                    </div>
                </div>
            </div>
            
            <!-- Order Summary -->
            <div>
                <div class="card" style="position: sticky; top: 20px;">
                    <h3 style="margin-bottom: 1.5rem;">Order Summary</h3>
                    
                    <div style="max-height: 300px; overflow-y: auto; margin-bottom: 1rem;">
                        {% for item in cart.items.all %}
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e2e8f0;">
                            {% if item.product.images.first %}
                            <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product.name }}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                            {% endif %}
                            <div style="flex: 1;">
                                <strong style="font-size: 0.9rem;">{{ item.product.name }}</strong><br>
                                <small style="color: #718096;">Qty: {{ item.quantity }}</small>
                            </div>
                            <strong style="color: #667eea;">â‚¹{{ item.line_total }}</strong>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem;">
                        <span>Subtotal:</span>
                        <strong>â‚¹{{ cart.subtotal }}</strong>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem;">
                        <span>Shipping:</span>
                        <strong>â‚¹10.00</strong>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 2px solid #e2e8f0;">
                        <span>Tax (10%):</span>
                        <strong>â‚¹{{ cart.subtotal|floatformat:2 }}</strong>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 2rem; font-size: 1.3rem;">
                        <strong>Total:</strong>
                        <strong style="color: #667eea;">â‚¹{{ cart.subtotal|add:"10"|floatformat:2 }}</strong>
                    </div>
                    
                    <button type="submit" class="btn" style="width: 100%; padding: 1rem; font-size: 1.1rem;">Place Order</button>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}
